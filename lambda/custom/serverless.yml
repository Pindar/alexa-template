service: skill-sample-nodejs-hello-world

plugins:
  - serverless-webpack
  - serverless-mocha-plugin

custom: ${file(./.env.${self:provider.stage}.yml)}

provider:
  name: aws
  runtime: nodejs6.10
  stackTags:
    APPLICATION: skill-sample-nodejs-hello-world
    TYPE: skill

  stage: ${opt:stage, 'dev'}
  region: ${self:custom.AWS_REGION}
  profile: ${self:custom.AWS_PROFILE}
  memorySize: ${self:custom.AWS_MEMORY_SIZE, '256'}
  cfLogs: true

functions:
  skill:
    handler: index.handler
    description: Alexa hello world skill
    events:
      - alexaSkill
    environment:
      DEBUG: ${self:custom.DEBUG, 'true'}
      NODE_ENV: ${self:custom.NODE_ENV, 'dev'}
      SKILL_FILE_STORAGE_BASE: ${self:custom.SKILL_FILE_STORAGE_BASE}
      SKILL_APP_ID: ${self:custom.SKILL_APP_ID}

resources:
  Resources:
    SkillSampleBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: ${self:custom.SKILL_FILE_STORAGE_BASE}-${self:provider.stage}
        AccessControl: Private
        CorsConfiguration:
          CorsRules:
          - AllowedMethods:
              - GET
            AllowedOrigins:
              - http://ask-ifr-download.s3.amazonaws.com
              - https://ask-ifr-download.s3.amazonaws.com
    SkillSampleBucketPolicy:
      Type: AWS::S3::BucketPolicy
      Properties:
        Bucket:
          Ref: SkillSampleBucket
        PolicyDocument:
          Statement:
            - Action:
                - 's3:GetObject'
              Effect: Allow
              Principal: '*'
              Resource:
                Fn::Join:
                  - ''
                  - - 'arn:aws:s3:::'
                    - Ref: SkillSampleBucket
                    - '/*'
